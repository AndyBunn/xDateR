---
title: "Report: Correlations between Series"
output: html_document
params:
  fileName: NA
  crsObject: NA
  crsParams: NA
---

```{r,echo=FALSE}
library(DT)
library(knitr)
crsObject <- params$crsObject
crsParams <- params$crsParams
```

The original file passed in to the xDateR app was `r params$fileName`.

Parameters used in `corr.rwl.seg()`:

```{r,echo=FALSE}
tab1 <- data.frame(Parameter=c("seg.length","bin.floor","n",
                               "prewhiten","pcrit","biweight","method"),
                   Value=c(crsObject$seg.length,crsParams$bin.floor,
                           crsParams$n, crsParams$prewhiten, 
                           crsParams$pcrit, crsParams$biweight,
                           crsParams$method))
kable(tab1,caption="corr.rwl.seg() params")
```


`corr.rwl.seg()` plot:

```{r,echo=FALSE}
plot(crsObject)
```


<div style = "width:80%; height:auto; margin: auto;">
```{r,echo=FALSE}
overallCor <- round(crsObject$overall,3)
res <- data.frame(Series=rownames(overallCor),
                  Correlation=overallCor[,1])
datatable(res,rownames = FALSE, 
          caption = "Overall Series Correlation",
          autoHideNavigation=TRUE,
          options = list(pageLength = nrow(res),
                         searching=FALSE,
                         lengthChange=FALSE)) %>%
  formatStyle('Correlation', 
              fontWeight = styleInterval(crsObject$pcrit, c('normal', 'bold')))
```


```{r,echo=FALSE}
    binNames <- paste(crsObject$bins[,1], "-", crsObject$bins[,2], sep="")
    res <- data.frame(series=binNames,round(crsObject$avg.seg.rho,3))
    colnames(res) <- c("Bin","Correlation")
    datatable(res,rownames = FALSE, 
              caption = "Avg. Correlation by Bin",
              autoHideNavigation=TRUE,
              options = list(pageLength = min(30,nrow(res)),
                             searching=FALSE,
                             lengthChange=FALSE)) %>%
      formatStyle('Correlation', 
                  fontWeight = styleInterval(crsObject$pcrit, c('normal', 'bold')))
```

```{r,echo=FALSE}
flags <- crsObject$flags
flagsLogical <- length(flags) == 0
```
</div>

`r if(flagsLogical){"There are no flagged Series / Segments"}`

```{r,echo=FALSE}
if(!flagsLogical){
  flags <- unlist(flags)
  flagsDF <- data.frame(Series=names(flags),
                        Bins=gsub(pattern = "\\.",
                                  replacement = "-",
                                  x = flags))  
  kable(flagsDF,row.names = FALSE, caption = "Flagged Series and Segments")  
}
```

```{r,echo=FALSE}
    binNames <- paste(crsObject$bins[,1], "-", crsObject$bins[,2], sep="")
    res <- round(crsObject$spearman.rho,3)
    res <- data.frame(series=rownames(res),res)
    colnames(res) <- c("Series",binNames)
    datatable(res,rownames = FALSE, 
              caption = "Series Correlation by Bin",
              autoHideNavigation=TRUE,
              options = list(pageLength = min(30,nrow(res)),
                             searching=TRUE,
                             lengthChange=FALSE)) %>%
      formatStyle(columns=-1, 
                  fontWeight = styleInterval(crsObject$pcrit, c('normal', 'bold')))
```
