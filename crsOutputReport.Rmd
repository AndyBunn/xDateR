---
title: "Report: Correlations between Series"
output: html_document
params:
  fileName: NA
  rwlObject: NA
  crsObject: NA
  crsParams: NA
---

```{r,echo=FALSE}
crsObject <- params$crsObject
crsParams <- params$crsParams
```

The original file passed in to the xDateR app was `{r params$fileName}`. The original number of series might have been modified by the user.

The `rwl` data after filtering:

```{r,echo=FALSE}
rwl.report(params$rwlObject)
```

```{r,echo=FALSE}
plot(params$rwlObject)
```


Parameters used in `corr.rwl.seg()`:

```{r,echo=FALSE}
tab1 <- data.frame(Parameter=c("seg.length","bin.floor","n",
                               "prewhiten","pcrit","biweight","method"),
                   Value=c(crsObject$seg.length,crsParams$bin.floor,
                           crsParams$n, crsParams$prewhiten, 
                           crsParams$pcrit, crsParams$biweight,
                           crsParams$method))
kable(tab1,caption="corr.rwl.seg() params")
```


`corr.rwl.seg()` plot:

```{r,echo=FALSE}
plot(crsObject)
```



```{r,echo=FALSE}
overallCor <- round(crsObject$overall,3)
res <- data.frame(Series=rownames(overallCor),
                  Correlation=overallCor[,1])
kable(res,row.names = FALSE, caption = "Overall Series Correlation")
```



```{r,echo=FALSE}
binNames <- paste(crsObject$bins[,1], "-", crsObject$bins[,2], sep="")
res <- round(crsObject$spearman.rho,3)
res <- data.frame(series=rownames(res),res)
colnames(res) <- c("Series",binNames)
kable(res,row.names = FALSE, caption = "Avg. Bin Correlation")
```



```{r,echo=FALSE}
binNames <- paste(crsObject$bins[,1], "-", crsObject$bins[,2], sep="")
res <- round(crsObject$spearman.rho,3)
res <- data.frame(series=rownames(res),res)
colnames(res) <- c("Series",binNames)

kable(res,row.names = FALSE, caption = "Series Correlation by Bin")
```

```{r,echo=FALSE}
flags <- crsObject$flags
flagsLogical <- length(flags) == 0
```

`r if(flagsLogical){"There are no flagged Series / Segments"}`

```{r,echo=FALSE}
if(!flagsLogical){
      flags <- unlist(flags)
      flagsDF <- data.frame(Series=names(flags),
                            Bins=gsub(pattern = "\\.",
                                      replacement = "-",
                                      x = flags))  
kable(flagsDF,row.names = FALSE, caption = "Flagged Series and Segments")  
}
```
